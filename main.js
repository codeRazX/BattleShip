(()=>{"use strict";const e=class{constructor(e,t){this.length=e,this.hits=0,this.sunk=!1,this.symbol=t,this.isPlaced=!1}hit=()=>this.hits++;isSunk=()=>this.sunk=this.hits===this.length},t=class{constructor(e){this.size=e,this.board=this.createBoard(this.size),this.ships=this.createShips()}createShips=()=>[new e(5,"A"),new e(4,"B"),new e(3,"C"),new e(3,"S"),new e(2,"D")];createBoard=e=>new Array(e).fill().map((()=>new Array(e).fill(0)));resetBoard=()=>this.board.map((e=>e.fill(0)));checkAttack=(e,t)=>1===this.board[e][t]||"X"===this.board[e][t];findShip=(e,t)=>this.ships.find((s=>s.symbol===this.board[e][t]));receiveAttack=(e,t)=>{if(this.checkAttack(e,t))return;const s=["Direct hit! The enemy ship is on fire!","Target locked and hit! The ship is damaged!","Bullseye! The enemy fleet is shaking!","Success! Enemy vessel struck with precision!","Impact confirmed! Heavy damage inflicted!"];let r;const i=Math.floor(Math.random()*s.length),a=this.findShip(e,t);return a&&!a.sunk?(a.hit(),a.isSunk(),r=a.sunk?["You sank the enemy ship! The seas are yours!","Ship down! The enemy fleet is falling apart!","Victory! You have sent the ship to the depths!","Another vessel destroyed! The tides are turning!","The enemy ship is no more! The waves are quiet for now..."][i]:s[i],this.board[e][t]=1,{symbol:a.symbol,message:r}):(this.board[e][t]="X",r=["Missed! The shot splashes into the empty waters","Miss! The sea mocks your aim","No hit! The enemy ship remains unscathed","Splash! Just water, no ships here","Empty oceanâ€¦ better luck next time!"][i],r)};checkNeighbors=(e,t)=>{const s=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,-1],[-1,1],[1,1]];for(const[r,i]of s){const s=e+r,a=t+i;if(s>=0&&a>=0&&s<this.board[0].length&&a<this.board.length&&0!==this.board[a][s])return!1}return!0};checkPosition=(e,t,s,r)=>{if("horizontal"===r){if(e.length+t>this.board[0].length)return!1;for(let r=0;r<e.length;r++)if(0!==this.board[s][t+r]||!this.checkNeighbors(t+r,s))return!1}else if("vertical"===r){if(e.length+s>this.board.length)return!1;for(let r=0;r<e.length;r++)if(0!==this.board[s+r][t]||!this.checkNeighbors(t,s+r))return!1}return!0};placeShips=()=>{this.ships.forEach((e=>{const t=Math.random()>.5?"horizontal":"vertical";for(;!e.isPlaced;){const s=Math.floor(Math.random()*this.board[0].length),r=Math.floor(Math.random()*this.board.length);if(this.checkPosition(e,s,r,t)){if("horizontal"===t)for(let t=0;t<e.length;t++)this.board[r][s+t]=e.symbol;else if("vertical"===t)for(let t=0;t<e.length;t++)this.board[r+t][s]=e.symbol;e.isPlaced=!0}}}))};displaceShips=()=>this.ships.forEach((e=>e.isPlaced=!1));resetShipsHits=()=>this.ships.forEach((e=>e.hits=0))},s=class{constructor(){this._currentShip=null,this.markedCells=[],this.angle=0,this.gameStarted=!1,this.gameOver=!1,this.refHitComputer=null}get currentShip(){return this._currentShip}set currentShip(e){this._currentShip=e}flip=e=>{this.angle=90===this.angle?0:90,e.forEach((e=>e.style.transform=`rotate(${this.angle}deg)`))};flag=()=>{const e=document.createElement("SPAN");return e.classList.add("flag"),e};showError=(e,t)=>{if(t.querySelector(".error"))return;const s=document.createElement("P");s.classList.add("error"),s.textContent=e,t.appendChild(s),setTimeout((()=>s.remove()),4e3)};insertRandomlyShips=(e,t)=>{const s=e.length;for(let r=0;r<s;r++)for(let i=0;i<s;i++)0!==e[r][i]&&t.querySelector(`[data-y="${r}"][data-x="${i}"]`).classList.add(`ship-${e[r][i]}`)};clearBoard=e=>{const t=e.querySelectorAll('[class*="ship-"]'),s=/^ship-/;t.forEach((e=>{e.classList.forEach((t=>{s.test(t)&&e.classList.remove(t)}))}))};paintRandomlyShips=(e,t,s)=>{e.ships.some((e=>e.isPlaced))&&(e.displaceShips(),e.resetBoard(),this.clearBoard(s)),e.placeShips(),this.insertRandomlyShips(e.board,s),t.classList.contains("anim-dissapear")||(t.classList.add("anim-disappear"),setTimeout((()=>t.style.display="none"),400))};dragStart=(e,t)=>{e.target.classList.add("dragging-original-el"),this.currentShip=t.find((t=>t.symbol===e.target.dataset.ship)),e.dataTransfer.setData("type-ship",e.target.dataset.ship)};dragOver=(e,t,s,r)=>{if(e.preventDefault(),e.target.classList.contains("cell")&&e.target.classList.length<=1){const i=0===r?"horizontal":"vertical";if(s.checkPosition(this.currentShip,Number(e.target.dataset.x),Number(e.target.dataset.y),i)){const r=t.findIndex((t=>t===e.target));for(let e=0;e<this.currentShip.length;e++){const a="horizontal"===i?e:e*s.board.length;t[r+a].classList.add("dragging-target"),this.markedCells.includes(t[r+a])||this.markedCells.push(t[r+a])}}}};dragDrop=(e,t,s,r)=>{if(e.preventDefault(),t.ships.every((e=>e.isPlaced)))return;if(!e.target.classList.contains("cell"))return;e.target.classList.remove("dragging-target");const i=parseInt(e.target.dataset.y),a=parseInt(e.target.dataset.x),n=0===s?"horizontal":"vertical",l=e.dataTransfer.getData("type-ship"),d=t.ships.find((e=>e.symbol===l));if(t.checkPosition(d,a,i,n)){for(let e=0;e<d.length;e++)"horizontal"===n?t.board[i][a+e]=d.symbol:t.board[i+e][a]=d.symbol;this.insertRandomlyShips(t.board,r),document.querySelector(`[data-ship="${l}"]`).style.display="none",d.isPlaced=!0}};dragLeave=()=>{this.markedCells.length<=0||this.markedCells.forEach((e=>e.classList.remove("dragging-target")))};dragEnd=(e,t,s,r)=>{e.target.classList.remove("dragging-original-el"),t.forEach((e=>{e.classList.contains("dragging-target")&&e.classList.remove("dragging-target")})),s.ships.every((e=>e.isPlaced))&&(r.classList.add("anim-disappear"),setTimeout((()=>r.style.display="none"),400)),this.markedCells=[],this.currentShip=null};resetGame=(e,t,s,r,i,a,n,l,d,h,o)=>{i.classList.remove("disabled-btn"),a.classList.remove("disabled-btn"),r.displaceShips(),s.displaceShips(),r.resetBoard(),s.resetBoard(),e.clearGrid(),t.clearGrid(),r.resetShipsHits(),s.resetShipsHits(),this.clearBoard(e.grid),this.clearBoard(t.grid),this.gameStarted=!1,this.gameOver=!1,d.textContent="",o.textContent="",l.style.display="flex",l.classList.remove("anim-disappear"),t.turn=!1,e.turn=!0,r.placeShips(),n.classList.add("disabled-btn"),this.angle=0,h.forEach((e=>{e.style.display="block",e.style.transform=`rotate(${this.angle}deg)`}))}},r=class{constructor(e,t,s,r){this.player=e,this.id=t,this.turn=r,this.gameBoard=s,this.grid=this.createGrid(),this.ships=this.gameBoard.ships,this.winner=!1,this.remainingCells=[...this.grid.children]}clearGrid=()=>{this.remainingCells=[...this.grid.children],this.remainingCells.forEach((e=>{e.classList.contains("splash-cell")&&e.classList.remove("splash-cell"),"player"!==this.id&&(e.classList.contains("cell-enemy")||e.classList.add("cell-enemy")),e.firstChild&&e.removeChild(e.firstChild)}))};createGrid=()=>{const e=this.gameBoard.board.length,t=document.createElement("DIV");t.id=this.id,t.classList.add("board");for(let s=0;s<e;s++)for(let r=0;r<e;r++){const e=document.createElement("DIV");e.classList.add("cell"),"player"!==this.id&&e.classList.add("cell-enemy"),e.dataset.y=s,e.dataset.x=r,t.appendChild(e)}return t};attack=(e,t,s,r)=>{const i=t.remainingCells.findIndex((t=>t.dataset.x===e.dataset.x&&t.dataset.y===e.dataset.y));if(-1===i)return;const a=t.remainingCells[i],n=a.dataset.y,l=a.dataset.x,d=t.gameBoard.receiveAttack(n,l);if("object"==typeof d?("player"===this.id&&(a.classList.remove("cell-enemy"),a.classList.add(`ship-${d.symbol}`)),a.appendChild(r),s.textContent=`${this.player}: ${d.message}`):(s.textContent=`${this.player}: ${d}`,a.classList.add("splash-cell")),t.remainingCells.splice(i,1),this.isLoose())return t.winner=!0,void(s.textContent=t.resultsWinner());this.turn=!1};turnOf=()=>this.player+" turn";isLoose=()=>this.ships.every((e=>e.sunk));resultsWinner=()=>this.player+" Wins!"};document.addEventListener("DOMContentLoaded",(()=>{const e=e=>document.querySelector(e),i=e=>document.getElementById(e),a=e(".text-turn"),n=e(".text-message"),l=e(".container-default"),d=i("container-board"),h=e(".ships"),o=Array.from(h.querySelectorAll("[data-ship]")),c=i("random-btn"),g=i("flip-btn"),p=i("play-btn"),m=i("restart-btn"),u=new s,f=new t(10),y=new t(10),b=new r("Player's","player",f,!0),v=new r("Computer's","computer",y,!1);d.append(b.grid,v.grid),y.placeShips();const L=Array.from(b.grid.children);o.forEach((e=>e.addEventListener("dragstart",(e=>u.dragStart(e,f.ships))))),b.grid.addEventListener("dragover",(e=>u.dragOver(e,L,f,u.angle))),b.grid.addEventListener("drop",(e=>u.dragDrop(e,f,u.angle,b.grid))),b.grid.addEventListener("dragleave",u.dragLeave),o.forEach((e=>e.addEventListener("dragend",(e=>u.dragEnd(e,L,f,h))))),g.addEventListener("click",(()=>u.flip(o))),c.addEventListener("click",(()=>u.paintRandomlyShips(f,h,b.grid))),p.addEventListener("click",(()=>{if(u.gameStarted)return;if(!f.ships.every((e=>e.isPlaced)))return void u.showError("You must place your ships to start the game!",l);c.classList.add("disabled-btn"),m.classList.remove("disabled-btn");const e=l.querySelector(".error");e&&e.remove(),setTimeout((()=>a.textContent=b.turnOf()),500),u.gameStarted=!0,p.classList.add("disabled-btn")})),v.grid.addEventListener("click",(e=>{if(u.gameStarted&&!u.gameOver&&e.target.classList.contains("cell")&&b.turn){if(b.turn&&!v.turn){if(b.attack(e.target,v,n,u.flag()),b.winner)return a.textContent="",void(u.gameOver=!0);if(!u.gameStarted)return;a.textContent=v.turnOf(),v.turn=!0}setTimeout((()=>{!b.turn&&v.turn&&(()=>{const e=b.remainingCells.length,t=Math.floor(Math.random()*e),s=b.remainingCells[t];if(v.attack(s,b,n,u.flag()),v.winner)return u.gameOver=!0,void(a.textContent="");setTimeout((()=>{u.gameStarted&&(a.textContent=b.turnOf(),b.turn=!0)}),1e3)})()}),1e3)}})),m.addEventListener("click",(()=>u.resetGame(b,v,f,y,p,c,m,h,n,o,a)))}))})();
//# sourceMappingURL=main.js.map